config {
    type: "table",
    database: "my-agentic-dataops",
    schema: "gold",
    name: "dim_customers",
    tags: ["daily", "gold"]
}

SELECT
  c.customer_id,
  c.first_name,
  c.last_name,
  c.email,
  c.country,
  c.signup_date,
  COUNT(o.order_id) AS total_orders,
  SUM(CASE
      WHEN o.status="completed" THEN o.amount
      ELSE 0
  END
    ) AS lifetime_value
FROM
  ${ref("silver", "customers_clean")} c
LEFT JOIN
  ${ref("silver", "orders_clean")} o
ON
  o.customer_id = c.customer_id
GROUP BY
  1,
  2,
  3,
  4,
  5,
  6
